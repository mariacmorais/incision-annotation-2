<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cholecystectomy Incision Annotation - Phase 02</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="layout">
    <header class="layout__header">
      <h1>Cholecystectomy Incision Annotation - Phase 02</h1>
      <p>
        Review each operative clip in sequence, then draw the incision line on the frozen final frame.
        After each submission, the next clip will load automatically. You will see a thank you message after all clips are complete.
      </p>
    </header>

    <section class="card">
      <header class="card__header">
        <h2>1. Enter Your Email</h2>
      </header>
      <div class="card__body card__body--stack">
        <label class="field">
          <span class="field__label">Email</span>
          <input
            id="participantIdInput"
            class="field__control"
            type="text"
            inputmode="text"
            autocomplete="off"
            placeholder="e.g., example@samplemail.com"
          />
        </label>

        <label class="field">
          <span class="field__label">How are you feeling right now?</span>
          <select id="fatigueInput" class="field__control">
            <option value="">-- Select --</option>
            <option value="1">1 - Fully alert</option>
            <option value="2">2 - Very lively</option>
            <option value="3">3 - Okay, fresh</option>
            <option value="4">4 - A little tired</option>
            <option value="5">5 - Moderately tired</option>
            <option value="6">6 - Very tired</option>
            <option value="7">7 - Completely exhausted</option>
          </select>
        </label>

        <p class="help" id="participantIdStatus">
          Enter your email. This is required before submitting your annotation.
        </p>
      </div>
    </section>

    <section class="card" aria-live="polite">
      <header class="card__header card__header--space">
        <h2>2. Watch Clip</h2>
        <div class="card__actions">
          <button id="replayBtn" type="button" class="ghost" disabled>Replay Clip</button>
        </div>
      </header>
      <div class="card__body">
        <div class="video-shell" id="videoShell">
          <video id="caseVideo" playsinline preload="auto"></video>
        </div>
        <p class="help" id="videoStatus">Loading first clipâ€¦</p>
      </div>
    </section>

    <section class="card">
      <header class="card__header card__header--space">
        <h2>3. Annotate Final Frame</h2>
        <div class="card__actions">
          <button id="clearLineBtn" type="button" class="ghost" disabled>Clear Line</button>
        </div>
      </header>
      <div class="card__body">
        <canvas id="finalFrame" width="1280" height="720" hidden></canvas>
        <div class="canvas-container" id="canvasContainer" hidden>
          <canvas id="annotationCanvas"></canvas>
          <p class="canvas-hint">
            Tap or click to place the start of the incision, drag, and release to finish. You can begin as
            soon as the frozen frame appears, even if the clip is still playing above.
          </p>
        </div>
        <p class="help" id="annotationStatus">The final frame will appear shortly below. You can keep watching while it prepares.</p>
      </div>
    </section>

    <section class="card">
      <header class="card__header">
        <h2>4. Submit Annotation</h2>
      </header>
      <div class="card__body card__body--stack">
        <button id="submitAnnotationBtn" type="button" class="primary" disabled>Submit to Investigator</button>
        <p class="help" id="submissionStatus">
          Draw the incision on the frozen frame to enable submission.
        </p>
      </div>
    </section>
  </main>

  <template id="toastTemplate">
    <div class="toast" role="status" aria-live="polite"></div>
  </template>

  <script src="clip-config.js"></script>
  <script src="app.js"></script>
</body>
</html>
